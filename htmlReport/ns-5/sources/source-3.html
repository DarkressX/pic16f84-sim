


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Memory</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">de.darkress.pic16f84sim.microcontroller</a>
</div>

<h1>Coverage Summary for Class: Memory (de.darkress.pic16f84sim.microcontroller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Memory</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    25.9%
  </span>
  <span class="absValue">
    (7/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    20.4%
  </span>
  <span class="absValue">
    (11/54)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    32.4%
  </span>
  <span class="absValue">
    (23/71)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package de.darkress.pic16f84sim.microcontroller;
&nbsp;
&nbsp;import java.util.Arrays;
&nbsp;
<b class="fc">&nbsp;public enum Memory</b>
&nbsp;{
<b class="fc">&nbsp;    Instance;</b>
&nbsp;
&nbsp;    Memory()
&nbsp;    {
&nbsp;        memory[0x81] = 0xFF; //Option
&nbsp;        memory[0x85] = 0x1F; //TrisA
&nbsp;        memory[0x86] = 0xFF; //TrisB
&nbsp;        setRegister(0x03, 0x18); //Status
&nbsp;    }
&nbsp;    private final int MEMORY_SIZE = 0xFF;  //Addressable Memory
&nbsp;    public int workingRegister = 0;
&nbsp;    private final int[] memory = new int[MEMORY_SIZE];
&nbsp;    private final int[] bank0UniqueSpecialRegister = new int[] {0x01,0x05,0x06,0x08,0x09}; //and many more
&nbsp;    private final int[] bank1UniqueSpecialRegister = new int[] {0x81,0x85,0x86,0x88,0x89}; //and many more
&nbsp;
&nbsp;    public void resetMemory() {
<b class="fc">&nbsp;        workingRegister = 0;</b>
<b class="fc">&nbsp;        Arrays.fill(memory, 0);</b>
<b class="fc">&nbsp;        memory[0x81] = 0xFF;</b>
<b class="fc">&nbsp;        memory[0x85] = 0x1F;</b>
<b class="fc">&nbsp;        memory[0x86] = 0xFF;</b>
<b class="fc">&nbsp;        setRegister(0x03, 0x18);</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getRegister(int address)
&nbsp;    {
<b class="fc">&nbsp;        if(address + 128 &gt; 255) //Guard statement to check for early errors in command de.darkress.pic16f84sim.decoder or implementation</b>
&nbsp;        {
<b class="fc">&nbsp;            throw new RuntimeException(&quot;Guard statement triggered. The address must be 7Bit long and can therefore not exceed 127&quot;);</b>
&nbsp;        }
<b class="pc">&nbsp;        if(address == 0x0)</b>
&nbsp;        {
<b class="fc">&nbsp;            int indirectAddress = getFSR();</b>
<b class="fc">&nbsp;            return getDataFromIndirectAddress(indirectAddress);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(getRegisterBank() != 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            if((Arrays.stream(bank1UniqueSpecialRegister).anyMatch(x -&gt; x == address))) //Check if register ist mapped</b>
&nbsp;            {
<b class="nc">&nbsp;                return memory[address + 128]; //Ensure data is read from bank 1</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return memory[address];</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setRegister(int address, int data)
&nbsp;    {
<b class="pc">&nbsp;        if(address + 128 &gt; 255) //Guard statement to check for early errors in command de.darkress.pic16f84sim.decoder or implementation</b>
&nbsp;        {
<b class="nc">&nbsp;            System.err.println(&quot;Guard statement triggered. The address must be 7Bit long and can therefore not exceed&quot; +</b>
&nbsp;                    &quot; 127&quot;);
<b class="nc">&nbsp;            System.exit(1);</b>
&nbsp;        }
<b class="pc">&nbsp;        if(address == 0x0)</b>
&nbsp;        {
<b class="nc">&nbsp;            int indirectAddress = getFSR();</b>
<b class="nc">&nbsp;            setDataFromIndirectAddress(indirectAddress, data);</b>
&nbsp;            return;
&nbsp;        }
<b class="pc">&nbsp;        if(address == 0x01 &amp;&amp; !Timer.getPrescalerAssignment()) //Reset PrescalerCounter if change on Option or Timer</b>
&nbsp;            // Register
&nbsp;        {
<b class="nc">&nbsp;            Timer.resetTimeToTimerIncrease();</b>
<b class="nc">&nbsp;            Timer.setCyclesToTimerIncrease(Timer.getCyclesToTimerIncrease() - 1); //Decrease by one to account for</b>
&nbsp;            // this command execution
&nbsp;        }
<b class="pc">&nbsp;        if((Arrays.stream(bank0UniqueSpecialRegister).anyMatch(x -&gt; x == address)) &amp;&amp; getRegisterBank() == 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            memory[address] = data;</b>
&nbsp;            return;
&nbsp;        }
<b class="pc">&nbsp;        if((Arrays.stream(bank0UniqueSpecialRegister).anyMatch(x -&gt; x == address)) &amp;&amp; getRegisterBank() == 1) //bank0</b>
&nbsp;            // because of 7 Bit address
&nbsp;        {
<b class="nc">&nbsp;            memory[address + 128] = data;</b>
&nbsp;            return;
&nbsp;        }
<b class="fc">&nbsp;        memory[address] = data;</b>
<b class="fc">&nbsp;        memory[address + 128] = data; //Ensure data is written to both banks to simulate mapping</b>
<b class="pc">&nbsp;        if(address == 0x2) //Check if PCL is destination</b>
&nbsp;        {
<b class="nc">&nbsp;            ProgramCounter.loadPc();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private int getDataFromIndirectAddress(int address)
&nbsp;    {
<b class="fc">&nbsp;        return memory[address];</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setDataFromIndirectAddress(int address, int data)
&nbsp;    {
<b class="nc">&nbsp;        if((address == 0x81 || address == 0x01) &amp;&amp; !Timer.getPrescalerAssignment()) //Reset PrescalerCounter if change on Option or Timer Register</b>
&nbsp;        {
<b class="nc">&nbsp;            Timer.resetTimeToTimerIncrease();</b>
<b class="nc">&nbsp;            Timer.setCyclesToTimerIncrease(Timer.getCyclesToTimerIncrease() - 1); //Decrease by one to account for</b>
&nbsp;            // this command execution
&nbsp;        }
<b class="nc">&nbsp;        if((Arrays.stream(bank0UniqueSpecialRegister).anyMatch(x -&gt; x == address)) || (Arrays.stream(bank1UniqueSpecialRegister).anyMatch(x -&gt; x == address)))</b>
&nbsp;        {
<b class="nc">&nbsp;            memory[address] = data;</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        memory[address % 128] = data; // else: Registers.Registers which are mapped</b>
<b class="nc">&nbsp;        memory[address % 128 + 128] = data; //Ensure data is written to both banks to simulate mapping</b>
&nbsp;    }
&nbsp;
&nbsp;    private int getRegisterBank()
&nbsp;    {
<b class="nc">&nbsp;        if((memory[0x03] &amp; 0x20) == 0x0)  //Check RP0 Bit of Bank0 Status Register</b>
&nbsp;        {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getFSR()
&nbsp;    {
<b class="fc">&nbsp;        return memory[0x4];</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getPCL()
&nbsp;    {
<b class="nc">&nbsp;        return memory[0x2];</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPCL(int data)
&nbsp;    {
<b class="nc">&nbsp;        memory[0x2] = data;</b>
<b class="nc">&nbsp;        memory[0x82] = data;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getPCLATH()
&nbsp;    {
<b class="nc">&nbsp;        return memory[0xA] &amp; 0x1F;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPCLATH(int data)
&nbsp;    {
<b class="nc">&nbsp;        memory[0xA] = data &amp; 0x1F;</b>
<b class="nc">&nbsp;        memory[0x8A] = data &amp; 0x1F;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getOption()
&nbsp;    {
<b class="nc">&nbsp;        return memory[0x81];</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getPortB() {
<b class="nc">&nbsp;        return memory[0x06];</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getPortA() {
<b class="nc">&nbsp;        return memory[0x05] &amp; 0x1F;</b>
&nbsp;    }
&nbsp;    public int getTimer()
&nbsp;    {
<b class="nc">&nbsp;        return memory[0x01];</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setTimer(int data)
&nbsp;    {
<b class="nc">&nbsp;        memory[0x01] = data;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getZeroBit()
&nbsp;    {
<b class="nc">&nbsp;        return (memory[0x03] &amp; 0x04) == 0x04;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setZeroBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] |= 0x04;</b>
<b class="nc">&nbsp;        memory[0x83] |= 0x04;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void clearZeroBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] &amp;= 0xFB;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getDigitCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        return (memory[0x03] &amp; 0x02) == 0x02;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDigitCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] |= 0x02;</b>
<b class="nc">&nbsp;        memory[0x83] |= 0x02;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void clearDigitCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] &amp;= 0xFD;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        if((memory[0x03] &amp; 0x01) == 0x01)</b>
&nbsp;        {
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
<b class="nc">&nbsp;        else return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] |= 0x01;</b>
<b class="nc">&nbsp;        memory[0x83] |= 0x01;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void clearCarryBit()
&nbsp;    {
<b class="nc">&nbsp;        memory[0x03] &amp;= 0xFE;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-27 18:01</div>
</div>
</body>
</html>
